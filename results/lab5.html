<h1 id="-5">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 5</h1>
<p>–û–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ <a href="https://github.com/specialistvlad/dut-db-organization-and-knowledges/blob/master/results/lab5.md">—Å—Å—ã–ª–∫–µ</a></p>
<h2 id="-">–ü–ª–∞–Ω –æ—Ç—á—ë—Ç–∞</h2>
<ol>
<li>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è REST —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ Node.js 11.</li>
<li>–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.</li>
<li>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.</li>
</ol>
<h2 id="-rest-node-js-11-">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è REST —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ Node.js 11.</h2>
<p>–î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—à docker-compose.yml —Ñ–∞–π–ª –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.</p>
<pre><code>dboak-backend:
  container_name: dboak-backend
  depends_on:
    - dboak-postgres
  links:
    - dboak-postgres
  build:
    context: ./
    dockerfile: ./backend/Dockerfile
  restart: always
  environment:
    - NODE_ENV=production
    - CNFG_API__PORT=3000
    - CNFG_DB__CONNECTION__HOST=dboak-postgres
    - CNFG_DB__CONNECTION__PORT=23395
  network_mode: bridge
  ports:
    - &#39;30562:38562&#39;
  logging:
      options:
          max-size: &#39;50m&#39;</code></pre><p>–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∞–ª–µ–µ:</p>
<ul>
<li>depends_on - –ø–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–ø—É—Å–∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞</li>
<li>links - –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ —Å –¥—Ä—É–≥–∏–º —É–∫–∞–∑–∞–Ω–Ω—ã–º</li>
<li>environment - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ(–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)</li>
</ul>
<p>–ù–∞–ø–∏—à–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è backend/Dockerfile</p>
<pre><code>FROM node:lts-slim

WORKDIR /opt
COPY config src package.json yarn.lock ./

RUN yarn --frozen-lockfile
EXPOSE 38562
ENTRYPOINT [&quot;node&quot;, &quot;.&quot;]
</code></pre><p>–£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ <code>yarn add pg express cnfg</code></p>
<p>–ù–∞–ø–∏—à–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è backend/src/index.js</p>
<pre><code>const { env, api } = require(&#39;../config&#39;);
const app = require(&#39;./app&#39;);
const { getClient } = require(&#39;./db&#39;);

const server = app.listen(api.port, () =&gt; {
  console.log(`NodeJS app running at:
    mode: ${(env.node_env).toUpperCase()}
    host: ${server.address().address}:${api.port}})
    time: ${new Date()}`);
});</code></pre><p>–ù–∞–ø–∏—à–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è backend/src/app.js</p>
<pre><code>const express = require(&#39;express&#39;);

const app = express();

app.get(&#39;/&#39;, async (req, res) =&gt; {
  console.log(&#39;–ó–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞üëç&#39;);
  res.send(&#39;–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ü§üüèΩ&#39;);
});

app.use(&#39;*&#39;, (req, res) =&gt; res.status(404).json({ description: &#39;Not found&#39; }));
app.use((err, req, res, next) =&gt; {
  console.error(err.stack);
  res.status(500).send(&#39;Something broke!&#39;);
});

module.exports = app;
</code></pre><p>–ù–∞–ø–∏—à–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è backend/src/db.js</p>
<pre><code>const { Client } = require(&#39;pg&#39;);
const { db: config } = require(&#39;../config&#39;);

let client;

const connect = async () =&gt; {
  client = new Client(config);

  if (!client) {
    throw new Error(&#39;Can\&#39;n instantiate pg client!&#39;);
  }

  await client.connect();
  console.log(&#39;Connection to DB successfull!&#39;);
  return client;
};

const query = async (...params) =&gt; {
  const cl = client || await connect();
  return cl.query(...params);
};

module.exports = {
  query,
  getClient: () =&gt; client,
};</code></pre><h2 id="-">–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</h2>
<p><code>docker-compose up --build</code></p>
<p>–£–≤–∏–¥–∏–º –º–Ω–æ–≥–æ –ª–æ–≥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ü—Ä–∏ —ç—Ç–æ–º –Ω–∞ –ë–î —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É–∂–µ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç —Ç.–∫. –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ë–î –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å –∏ docker –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏.</p>
<pre><code>‚ûú  dut-db-organization-and-knowledges git:(master) ‚úó ./clean.sh; docker-compose up --build
rm: ./results/*.html: No such file or directory
No stopped containers
Building dboak-md-to-html
Step 1/4 : FROM node:lts-slim
 ---&gt; da165a9e35d9
Step 2/4 : WORKDIR /opt/results
 ---&gt; Using cache
 ---&gt; 90773ba33ecf
Step 3/4 : RUN yarn global add marked;
 ---&gt; Using cache
 ---&gt; 8771ccde18e1
Step 4/4 : ENTRYPOINT for f in *.md ; do marked &quot;$f&quot; -o &quot;${f%%.*}&quot;.html ; done; cp README.html index.html; rm ./README.html;
 ---&gt; Using cache
 ---&gt; ce31b51d520e
Successfully built ce31b51d520e
Successfully tagged dut-db-organization-and-knowledges_dboak-md-to-html:latest
Building dboak-backend
Step 1/8 : FROM node:lts-slim
 ---&gt; da165a9e35d9
Step 2/8 : WORKDIR /opt
 ---&gt; Using cache
 ---&gt; 200a7e0f9380
Step 3/8 : COPY config  ./
 ---&gt; 3e724d32a91a
Step 4/8 : COPY src ./
 ---&gt; 751f71980678
Step 5/8 : COPY package.json yarn.lock ./
 ---&gt; 30a87126f533
Step 6/8 : RUN yarn --frozen-lockfile
 ---&gt; Running in 9ab28a0cbfbe
yarn install v1.12.3
warning package.json: No license field
warning No license field
[1/4] Resolving packages...
[2/4] Fetching packages...
info fsevents@1.2.4: The platform &quot;linux&quot; is incompatible with this module.
info &quot;fsevents@1.2.4&quot; is an optional dependency and failed compatibility check. Excluding it from installation.
[3/4] Linking dependencies...
[4/4] Building fresh packages...
Done in 20.10s.
Removing intermediate container 9ab28a0cbfbe
 ---&gt; cb7c4cb847bc
Step 7/8 : EXPOSE 38562
 ---&gt; Running in 5c077c6262a0
Removing intermediate container 5c077c6262a0
 ---&gt; 9edde83ad371
Step 8/8 : ENTRYPOINT [&quot;node&quot;, &quot;.&quot;]
 ---&gt; Running in e76c12cf97c8
Removing intermediate container e76c12cf97c8
 ---&gt; 5846296ac305
Successfully built 5846296ac305
Successfully tagged dut-db-organization-and-knowledges_dboak-backend:latest
Creating dboak-postgres   ... done
Creating dboak-md-to-html ... done
Creating dboak-backend    ... done
Attaching to dboak-md-to-html, dboak-postgres, dboak-backend
dboak-backend       | NodeJS app running at:
dboak-backend       |     mode: PRODUCTION
dboak-backend       |     host: :::38562})
dboak-backend       |     time: Tue Dec 11 2018 12:46:08 GMT+0000 (Coordinated Universal Time)</code></pre><p>–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ <code>NodeJS app running at</code> –æ–∑–Ω–∞—á–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.</p>
<h2 id="-">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.</h2>
<p>–ü–µ—Ä–µ–π–¥–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É <code>http://localhost:30562/</code>
–í–∏–¥–∏–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω—è–ª –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç–∏–ª.
<img src="./screenshots/lab5-screen-1.png" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã">
<img src="./screenshots/lab5-screen-2.png" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã"></p>
